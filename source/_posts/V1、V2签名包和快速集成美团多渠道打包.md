---
layout: android
title: V1、V2签名包和快速集成美团多渠道打包
date: 2018-05-18 12:00:10
tags: 打包
---

本文主要介绍Android V1、V2签名包的基本概念和使用场景以及如何快速掌握美团多渠道打包。

1. 美团多渠道打包的快速使用和集成
2. Android Studio 2.3版本及以上，V1、V2版本签名包的相关说明
3. V1、V2版本签名包的比较以及在本文提供的多渠道打包方案下，两种签名包的选择

开始

首先下载美团打包工具，下载完毕以后，解压出来会有2个包，一个是Python的安装环境，一个是美团打包的工具。其中，美团的打包工具是一个压缩包，解压之后，有如下文件。
![](1.jpg)

下载无误之后，即可开始快速集成美团多渠道集成步骤：

步骤1：配置Python环境

这里就不讲解了，到python官网上下载最新的python安装包然后安装就行了

步骤2：

集成好Python的环境配置以后，打开下载好的美团打包工具。也就是本文第一张图，首先，有一个JavaUtil，这个是获取渠道信息的代码（可以自己Copy到项目，根据项目需求去集成使用）；还有一个PythonTool文件夹，这个就是美团打包的核心，点进这个文件夹之后，如图：
![](2.webp)

我们只需要把生成好的正式签名包，copy在这里。（这里只是演示，也就是app-release.apk这个文件）我们只需要把写好的正式签名包，copy在这里。注意：必须是同级目录。
![](3.webp)

然后，点击MultiChannelBuildTool这个python文件，点击一下即可！
![](4.webp)

点击之后，会生成一个紫色框的文件夹，我们点进去该文件夹
![](5.webp)

一瞬间生成了这么多个apk,耗时半秒不到。

基本的多渠道打包使用就已经完成了。

十分钟不到吧应该。是的，已经打包完毕了。

问题1：如何配置其他的渠道？

info文件夹，目录下的channel就是用来存放打包渠道的，注意：多个渠道之间请用换行隔开、多个渠道之间请用换行隔开（不建议使用Windows下面的txt直接打开，强烈建议使用notepad++等第三方文字编辑工具使用编辑！！！）

问题2：如何获取渠道信息？

在前面说到了，给大家准备的下载链接里面，解压缩后有个JavaUtil的包，这里面就是获取渠道信息的代码，开发者可以根据这个工具类，去获取渠道号。或者根据开发需要自己集成使用即可。

关于V1、V2签名包的说明：

说完了美团多渠道打包，我们在说说V1、V2签名包。

如果我们升级到最新的AS（笔者的是3.0），点击打包选项，细心的你会看到这样的打包界面：
![](6.webp)

老版本的AS，只有V1选择，也就是紫色的框框。但是新版本的AS，默认勾选的是V2版本（笔者的AS默认是勾选的V2版本）。如果只勾选V2版本，打出来的签名包，很多机型会直接提示安装失败。解决办法下面会说。

概述：

在Android 7.0中引入了APK Signature Scheme v2，v1是jar Signature来自JDK。

V1：应该是通过ZIP条目进行验证，这样APK 签署后可进行许多修改，这样可以移动甚至重新压缩文件。

V2：验证压缩文件的所有字节，而不是单个 ZIP 条目，因此，在签名后无法再更改(包括 zipalign)。正因如此，现在在编译过程中，我们将压缩、调整和签署合并成一步完成。好处显而易见，更安全而且新的签名可缩短在设备上进行验证的时间（不需要费时地解压缩然后验证），从而加快应用安装速度。

刚才说了，如果只勾选V2版本，打出来的签名包，很多机型会直接提示安装失败。下面就给大家提供两种解决方案

解决方案一：

V1和V2的签名使用：

1）只勾选V1签名并不会影响什么，但是在7.0上不会使用更安全的验证方式

2）只勾选V2签名7.0以下会直接安装完显示未安装，7.0以上则使用了V2的方式验证

3）同时勾选V1和V2则所有机型都没问题。

解决办法二：

还有一种快速高效的代码解决方式，我们可以直接在app的build.gradle的android标签下，加入以下代码也可以解决只勾选V2版本签名包部分机型会提示安装失败的问题。
![](7.webp)

V2签名包是从Android7.0系统出现的新的签名机制，这个新机制使得apk的签名方式更加安全。首先我们应该尝试把V1和V2两个选项全部勾选，并尽可能的去使用他们，但是如果全部勾选完毕出现了问题，那么我们可以忽略这种新的签名机制，只勾选第一个选项(V1)，依旧使用我们之前老的签名机制，也就是说，V1版本更加快速方便。

为什么这里会提到V1、V2的区别。因为这里的美团多渠道打包只能适用于V1版本的签名包，MMP